---
title: "手搓PE32可执行文件"
date: 2024-05-08
category: [basic]
tags: [Format]
img_path: /assets/images/
---

本项目通过手动创建一个简单的exe文件，介绍PE32可执行文件的基本结构。作为入门级别的教程，本文尽可能把需要的前置知识将到最低。其他必要的知识在构建文件的时候讲解。

## 一、项目目标：手动创建简单的PE.exe程序。

功能：弹出一个如下图的对话框（图）

![messagebox]({{ page.name | remove: '.md' }}/messagebox.png)

## 二、基础知识

### 在开始正式创建PE文件之前，默认操作者掌握以下概念（不懂的，可以自行学习，不难）：

* 懂得二进制、十进制、十六进制的表示、计算和转换
* 理解计算机中 bit 和 byte 的概念、组织方式和表示。
* 理解BYTE、WORD、DWORD的概念。
* 掌握 little ending 规范。
* 了解 ASCII 编码和 C 字符串规则。
* 学习过C语言，知道struct结构的尤佳，但不强求。
* 会使用至少一种二进制编辑工具，推荐 ImHex，易上手开源无费用。

### 基础知识 1：进程虚拟地址空间

Widnows中运行一个程序，系统会首先为这个程序创建一个“进程”。进程是程序运行的容器，包含程序运行所需要的各种资源。<br>我们知道程序只有加载到内存才能运行，磁盘上的exe程序加载到内存哪里呢？<br>与我们想象的直接加载到计算机的物理内存不同，操作系统通过“进程”容器给程序提供了一个叫做“虚拟内存地址空间”的东西。磁盘上的exe文件是加载到这个“虚拟内存空间”中的。现代操作系统这么设计的主要目的就是屏蔽操作物理内存的底层细节，让程序员开发的程序面对一个一致的，完整的运行空间。<br>以手动创建的PE.exe为例，其运行时的虚拟内存空间环境大致如下图：

![]({{ page.name | remove: '.md' }}/memory_layout.drawio.png)

> 由于栈是基于线程的，为了让本项目涉及到的知识最简单，这里不做介绍。
